<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aton4ST Demo</title>
    <link rel="stylesheet" href="./css/demo.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
    <header>
        <img src="img/aton4stlogo.jpg" alt="Aton4ST Logo" class="logo">
        <nav>
            <a href="demo.html">Home</a>
            <a href="#">Features</a>
            <a href="demo.html">Demo</a>
            <a href="#">About</a>
            <a href="#">Contact</a>
        </nav>
    </header>

    <div class="demo-container">
        <section id="demo-video">
            <h2>Aton4ST Platform Overview</h2>
            <div class="video-embed">
                <iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ" title="Aton4ST Demo Placeholder" frameborder="0"></iframe>
            </div>

            <h3>Climate Analysis Engine</h3>
            <div class="climate-analysis-trigger">
                <h3>Run Server-Side Analysis</h3>
                <button onclick="runClimateAnalysis()">Analyze Mock Dataset</button>
                <h4>Analysis Results:</h4>
                <pre id="analysis-results">Click button to run analysis...</pre>
            </div>
        </section>

        <div class="interactive-demo">
            <div class="climate-dashboard">
                <h3>Real-time Climate Metrics</h3>
                <div class="chart-container">
                    <canvas id="climateChart"></canvas>
                </div>
                <div class="climate-chatbot">
                    <h4>Climate Data Assistant</h4>
                    <div class="chat-history" id="climateChat">
                        <div class="message bot">Ask me about climate trends or Earth observation data!</div>
                    </div>
                    <div class="chat-input">
                        <input type="text" id="climateQuery" placeholder="Type your climate question..." onkeydown="if(event.key === 'Enter') sendClimateQuery()">
                        <button onclick="sendClimateQuery()">Ask</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>Â© 2025 Aton4ST. Democratizing Space Science.</p>
        <a href="#">License</a> | <a href="#">Privacy</a>
    </footer>

    <script>
        // Ensure DOM is fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM Fully Loaded - Initializing Scripts");

            // --- Climate Analysis API Call ---
            async function runClimateAnalysis() {
                const resultsDisplay = document.getElementById('analysis-results');
                resultsDisplay.textContent = 'Analyzing...';

                // Mock dataset
                const mockDataset = [
                    { temp: 15.1, co2: 380, seaLevel: 0.1 },
                    { temp: 15.2, co2: 385, seaLevel: 0.12 },
                    { temp: 15.3, co2: 390, seaLevel: 0.15 }
                ];

                try {
                    const response = await fetch('/api/analyze', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(mockDataset)
                    });

                    if (!response.ok) {
                        throw new Error(`Error: ${response.status}`);
                    }

                    const results = await response.json();
                    resultsDisplay.textContent = JSON.stringify(results, null, 2);
                } catch (error) {
                    console.error("Error analyzing data:", error);
                    resultsDisplay.textContent = `Error: ${error.message}`;
                }
            }

            // --- Chatbot API Call ---
            async function sendClimateQuery() {
                const input = document.getElementById('climateQuery');
                const message = input.value.trim();
                const chat = document.getElementById('climateChat');
                if (!message) return;

                // Add user message to chat
                const userMsg = document.createElement('div');
                userMsg.className = 'message user';
                userMsg.textContent = message;
                chat.appendChild(userMsg);

                // Add thinking message
                const thinkingMsg = document.createElement('div');
                thinkingMsg.className = 'message bot';
                thinkingMsg.textContent = 'Thinking...';
                chat.appendChild(thinkingMsg);

                try {
                    const response = await fetch('/api/climate-ai', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ query: message })
                    });

                    if (!response.ok) {
                        throw new Error(`Error: ${response.status}`);
                    }

                    const data = await response.json();
                    thinkingMsg.textContent = data.answer;
                } catch (error) {
                    console.error("Error fetching chatbot response:", error);
                    thinkingMsg.textContent = `Error: ${error.message}`;
                }
            }

            // Attach functions to global scope
            window.runClimateAnalysis = runClimateAnalysis;
            window.sendClimateQuery = sendClimateQuery;
        });
    </script>
</body>
</html>